<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · Polyester.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://JuliaSIMD.github.io/Polyester.jl/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Polyester.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaSIMD/Polyester.jl/blob/master/docs/src/index.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Polyester"><a class="docs-heading-anchor" href="#Polyester">Polyester</a><a id="Polyester-1"></a><a class="docs-heading-anchor-permalink" href="#Polyester" title="Permalink"></a></h1><ul><li><a href="#Polyester.UnsignedIteratorEarlyStop"><code>Polyester.UnsignedIteratorEarlyStop</code></a></li><li><a href="#Polyester.@batch-Tuple{Any}"><code>Polyester.@batch</code></a></li></ul><article class="docstring"><header><a class="docstring-binding" id="Polyester.UnsignedIteratorEarlyStop" href="#Polyester.UnsignedIteratorEarlyStop"><code>Polyester.UnsignedIteratorEarlyStop</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">UnsignedIteratorEarlyStop(thread_mask[, num_threads = count_ones(thread_mask)])</code></pre><p>Iterator, returning <code>(i,t) = Tuple{UInt32,UInt32}</code>, where <code>i</code> iterates from <code>1,2,...,num_threads</code>, and <code>t</code> gives the threadids to call <code>ThreadingUtilities.taskpointer</code> with.</p><p>Unfortunately, codegen is suboptimal when used in the ergonomic <code>for (i,tid) ∈ thread_iterator</code> fashion. If you want to microoptimize, You&#39;d get better performance from a pattern like:</p><pre><code class="language-julia hljs">function sumk(u,l = count_ones(u) % UInt32)
    uu = ServiceSolicitation.UnsignedIteratorEarlyStop(u,l)
    s = zero(UInt32); state = ServiceSolicitation.initial_state(uu)
    while true
        iter = iterate(uu, state)
        iter === nothing &amp;&amp; break
        (i,t),state = iter
        s += t
    end
    s
end</code></pre><p>This iterator will iterate at least once; it&#39;s important to check and exit early with a single threaded version.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaSIMD/Polyester.jl/blob/1d7690f70b0f347e248ee48666993f2a118285d3/src/unsignediterator.jl#L29-L52">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Polyester.@batch-Tuple{Any}" href="#Polyester.@batch-Tuple{Any}"><code>Polyester.@batch</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@batch for i in Iter; ...; end</code></pre><p>Evaluate the loop on multiple threads.</p><pre><code class="nohighlight hljs">@batch minbatch=N for i in Iter; ...; end</code></pre><p>Evaluate at least N iterations per thread. Will use at most <code>length(Iter) ÷ N</code> threads.</p><pre><code class="nohighlight hljs">@batch per=core for i in Iter; ...; end
@batch per=thread for i in Iter; ...; end</code></pre><p>Use at most 1 thread per physical core, or 1 thread per CPU thread, respectively. One thread per core will mean less threads competing for the cache, while (for example) if there are two hardware threads per physical core, then using each thread means that there are two independent instruction streams feeding the CPU&#39;s execution units. When one of these streams isn&#39;t enough to make the most of out of order execution, this could increase total throughput.</p><p>Which performs better will depend on the workload, so if you&#39;re not sure it may be worth benchmarking both.</p><p>LoopVectorization.jl currently only uses up to 1 thread per physical core. Because there is some overhead to switching the number of threads used, <code>per=core</code> is <code>@batch</code>&#39;s default, so that <code>Polyester.@batch</code> and <code>LoopVectorization.@tturbo</code> work well together by default.</p><p>You can pass both <code>per=(core/thread)</code> and <code>minbatch=N</code> options at the same time, e.g.</p><pre><code class="nohighlight hljs">@batch per=thread minbatch=2000 for i in Iter; ...; end
@batch minbatch=5000 per=core   for i in Iter; ...; end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaSIMD/Polyester.jl/blob/1d7690f70b0f347e248ee48666993f2a118285d3/src/closure.jl#L195-L225">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.5 on <span class="colophon-date" title="Sunday 8 August 2021 19:23">Sunday 8 August 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
